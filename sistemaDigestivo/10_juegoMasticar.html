<style type="text/css">

.contenidoCapitulo
{
	background: #71d2db;
	font-family: 'Exo', sans-serif;
	height: 100%;
	padding: 20px;
	text-align: center;
	width: 100%;
}

.titulo{
	background: #791e73;
	background-clip: padding-box;
	border: 2px solid white;
	border-radius: 15px;
	display: block;
	font-size: 24px;
	margin: -5px auto 30px;
	padding: 10px;
	text-shadow: 2px 0 0 #fff, -2px 0 0 #fff, 0 2px 0 #fff, 0 -2px 0 #fff, 1px 1px #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff;
	width: 70%;
}

.boton
{
	background-clip: padding-box;
	border: 1px solid black;
	border-radius: 100%;
	height: 50px;
	width: 50px;
}

.panelJuego
{
	background-image: url("images/escena7/tablero.png");
	background-repeat: no-repeat;
	height: 500px;
	position: absolute;
	right: 25px;
	top: 80px;
	width: 750px;
}

.panelJuego .seccion
{
	position: absolute;
}

.panelJuego .seccion div
{
	background-clip: padding-box;
	border: 2px solid white;
	border-radius: 10px;
	font-weight: bold;
	text-align: center;
	width: 100%;
}

.panelJuego .acciones
{
	height: 262px;
	right: 30px;
	top: 126px;
	width: 165px;
}

.panelJuego .acciones div
{
	background: #791e73;
	color: white;
	cursor: pointer;
	height: 35px;
	line-height: 35px;
	margin: 10px auto;
}

.panelJuego .bonos
{
	height: 160px;
	right: 30px;
	top: 319px;
	width: 165px;
}

.panelJuego .bonos div
{
	background: #92532a;
	color: white;
	cursor: pointer;
	height: 45px;
	line-height: 45px;
	margin: 20px auto;
}

.panelJuego .indicadores
{
	height: 110px;
	left: 30px;
	top: 190px;
	width: 190px;
}

.panelJuego .indicadores div
{
	background: #92532a;
	color: white;
	height: 25px;
	line-height: 25px;
	margin: 20px auto;
	overflow: hidden;
	position: relative;
}

.panelJuego .indicadores div:first-child
{
	background: #d25adf;
}

.panelJuego .indicadores .nivelSaliva,
.panelJuego .indicadores .vidasDisponibles
{
	background: red;
}

.panelJuego .indicadores .nivelSaliva .medidor,
.panelJuego .indicadores .vidasDisponibles .medidor
{
	display: block;
	height: 100%;
	width: 50%;
}

.panelJuego .indicadores .nivelSaliva .medidor
{
	background: #177ac5;
}

.panelJuego .indicadores .vidasDisponibles .medidor
{
	background: #009933;
}

.panelJuego .indicadores .nivelSaliva .texto,
.panelJuego .indicadores .vidasDisponibles .texto
{
	display: block;
	height: 100%;
	position: absolute;
	top: 0px;
	width: 100%;
}

.panelJuego .marcadores
{
	height: 85px;
	left: 22px;
	top: 30px;
	width: 94%;
}

.panelJuego .marcadores div
{
	background: #29929b;
	color: white;
	display: inline-block;
	height: 60px;
	line-height: 30px;
	margin: 10px 1%;
	overflow: hidden;
	position: relative;
	width: 30%;
}

.panelJuego .marcadores div span
{
	display: block;
}

.panelJuego .tiempo
{
	height: 50px;
	left: 30;
	top: 127px;
	width: 190;
}

.panelJuego .tiempo div
{
	background: #29929b;
	color: white;
	height: 60px;
	line-height: 30px;
	overflow: hidden;
	position: relative;
	width: 100%;
}

.panelJuego .tiempo div span
{
	display: block;
}

.panelJuego .tiempo div span
{
	display: block;
}

.panelJuego .instrucciones
{
	background: #29929b;
	background-clip: padding-box;
	border: 2px solid white;
	border-radius: 15px;
	bottom: 15px;
	color: white;
	height: 77px;
	line-height: 35px;
	margin: 10px auto;
	right: 23px;
	text-align: center;
	width: 700px;
}

.panelJuego .cabeza
{
	background-image: url("images/escena7/juego_fondo.png");
	height: 263px;
	left: 235px;
	position: absolute;
	top: 125px;
	width: 309px;
}

.panelJuego .cabeza .mandibula
{
	background-image: url("images/escena7/juego_mandibula.png");
	height: 109px;
	left: 88px;
	position: absolute;
	top: 125px;
	width: 161px;
}

.panelJuego .cabeza .masticar
{
	-webkit-animation: mastica 0.2s; /* Chrome, Safari, Opera */
    animation: mastica 0.2s;
}

/* Chrome, Safari, Opera */
@-webkit-keyframes mastica {
    0% {
    	transform:rotate(0deg);
		-ms-transform:rotate(0deg); /* IE 9 */
		-webkit-transform:rotate(0deg); /* Opera, Chrome, and Safari */
    }
    50% {
    	transform:rotate(-8deg);
		-ms-transform:rotate(-8deg); /* IE 9 */
		-webkit-transform:rotate(-8deg); /* Opera, Chrome, and Safari */
    }
    90% {
    	transform:rotate(0deg);
		-ms-transform:rotate(0deg); /* IE 9 */
		-webkit-transform:rotate(0deg); /* Opera, Chrome, and Safari */
    }
    100% {
    	transform:rotate(0deg);
		-ms-transform:rotate(0deg); /* IE 9 */
		-webkit-transform:rotate(0deg); /* Opera, Chrome, and Safari */
    }
}

/* Standard syntax */
@keyframes mastica {
    0% {
    	transform:rotate(0deg);
		-ms-transform:rotate(0deg); /* IE 9 */
		-webkit-transform:rotate(0deg); /* Opera, Chrome, and Safari */
    }
    50% {
    	transform:rotate(15deg);
		-ms-transform:rotate(15deg); /* IE 9 */
		-webkit-transform:rotate(15deg); /* Opera, Chrome, and Safari */
    }
    90% {
    	transform:rotate(0deg);
		-ms-transform:rotate(0deg); /* IE 9 */
		-webkit-transform:rotate(0deg); /* Opera, Chrome, and Safari */
    }
    100% {
    	transform:rotate(0deg);
		-ms-transform:rotate(0deg); /* IE 9 */
		-webkit-transform:rotate(0deg); /* Opera, Chrome, and Safari */
    }
}

.panelJuego .cabeza .esofago
{
	background-image: url("images/escena7/juego_esofago.png");
	height: 103px;
	left: 118px;
	position: absolute;
	top: 147px;
	width: 77px;
}

.panelJuego .cabeza .traquea
{
	background-image: url("images/escena7/juego_traquea.png");
	height: 84px;
	left: 131px;
	position: absolute;
	top: 169px;
	width: 29px;
}

.panelJuego .cabeza .glandulas
{
	background-image: url("images/escena7/glandulas.png");
	height: 27px;
	left: 155px;
	position: absolute;
	top: 175px;
	width: 30px;
}

.panelJuego .cabeza .paladar
{
	background-image: url("images/escena7/paladar.png");
	height: 25px;
	left: 124px;
	position: absolute;
	top: 150px;
	width: 36px;
}

.panelJuego .cabeza .bolo
{
	background: black;
	background-clip: padding-box;
	border-radius: 100%;
	left: 270px;
	position: absolute;
	top: 165px;
	height: 20px;
	width: 20px;
}

</style>

<script type="text/javascript">

var niveles = Array();

niveles.push( { nombre : "Turorial", reduccionSalivaPorAcion : 2, numeroBolos : 1, recargaSaliva: 100, tiempo: 60 } );
niveles.push( { nombre : "Nivel 1 - Facil", reduccionSalivaPorAcion : 2, numeroBolos : 3, recargaSaliva: 100, tiempo: 60 } );
niveles.push( { nombre : "Nivel 2 - Facil", reduccionSalivaPorAcion : 2, numeroBolos : 4, recargaSaliva: 100, tiempo: 60 } );
niveles.push( { nombre : "Nivel 3 - Facil", reduccionSalivaPorAcion : 2, numeroBolos : 5, recargaSaliva: 100, tiempo: 60 } );
niveles.push( { nombre : "Nivel 4 - Normal", reduccionSalivaPorAcion : 4, numeroBolos : 6, recargaSaliva: 75, tiempo: 90 } );
niveles.push( { nombre : "Nivel 5 - Normal", reduccionSalivaPorAcion : 4, numeroBolos : 7, recargaSaliva: 75, tiempo: 90 } );
niveles.push( { nombre : "Nivel 6 - Normal", reduccionSalivaPorAcion : 4, numeroBolos : 8, recargaSaliva: 75, tiempo: 90 } );
niveles.push( { nombre : "Nivel 7 - Normal", reduccionSalivaPorAcion : 4, numeroBolos : 9, recargaSaliva: 75, tiempo: 90 } );
niveles.push( { nombre : "Nivel 8 - Dificil", reduccionSalivaPorAcion : 6, numeroBolos : 10, recargaSaliva: 50, tiempo: 90 } );
niveles.push( { nombre : "Nivel 9 - Dificil", reduccionSalivaPorAcion : 6, numeroBolos : 11, recargaSaliva: 50, tiempo: 90 } );
niveles.push( { nombre : "Nivel 10 - Dificil", reduccionSalivaPorAcion : 6, numeroBolos : 12, recargaSaliva: 50, tiempo: 90 } );
niveles.push( { nombre : "Pro", reduccionSalivaPorAcion : 10, numeroBolos : 12, recargaSaliva: 25, tiempo: 60 } );

</script>

<script type="text/javascript">

var nivelActual;
var numeroNivel = 0;
var nivelSaliva = 100;
var jugos = 3;
var reduccionSalivaPorAcion = 0;
var masticadasNecesarias = 10;
var masticadasActuales = 0;
var etapaActual = 0;/* 0 = masticar, 1 = cerrarPaladar, 2 = cerrarTraquea, 3 = usaLengua, 4 = traga*/
var bolosRestantes = 0;
var bolosConsumidos = 0;
var totalBolosConsumidos = 0;
var seAtraganto = false;
var vidasDisponibles = 100;
var disminucionVidaPorAtragantamiento = 25;

$(document).ready(function(){

	agregarSaliva(nivelSaliva);
	agregaVida(vidasDisponibles);
	procesarNivel();

	$(".button").on("click", function(){
		CambiarEscena("8juegoMasticar.html");
	});

	$(".jugo").on("click", function(){
		consumeJugo();
	});

	$(".panelJuego .masticar_btn").on("click", function(){
		ProcesaMasticar("masticar");
	});

	$(".panelJuego .paladar_btn").on("click", function(){
		ProcesaMasticar("paladar_btn");
	});

	$(".panelJuego .traquea_btn").on("click", function(){
		ProcesaMasticar("traquea_btn");
	});

	$(".panelJuego .lengua_btn").on("click", function(){
		ProcesaMasticar("lengua_btn");
	});

});

function procesarNivel()
{
	etapaActual = 0;
	nivelActual = niveles[numeroNivel];

	$(".nivel").html(nivelActual.nombre);
	$(".jugo .value").html(jugos);

	seAtraganto = false;
	bolosConsumidos = 0;
	bolosRestantes = nivelActual.numeroBolos;
	$(".bolosRestantes .value").html(bolosRestantes);
	reduccionSalivaPorAcion = nivelActual.reduccionSalivaPorAcion;

	ProcesaMasticar("proceso");
}

function instrucciones()
{
	switch(etapaActual)
	{
		case 0:{
			$(".instrucciones").html("Usa el botón de masticar para que las glándulas salivales inyecten saliva para facilitar que la comida sea triturada más fácilmente y elaborar el bolo alimenticio.");
		}break;
		case 1:{
			if(masticadasActuales < 5)
				$(".instrucciones").html("Usa el botón de masticar para que las glándulas salivales inyecten saliva para facilitar que la comida sea triturada más fácilmente y elaborar el bolo alimenticio.");
			else
				$(".instrucciones").html("Ten mucho cuidado porque a veces, sin darte cuenta, te quedarás sin saliva, por lo que tendrás que recurrir al jugo disponible para recargar el indicador de saliva. ");
		}break;
		case 2:{
			$(".instrucciones").html("Cierra el paladar para comenzar a pasar la comida. ¡CUIDADO! ¡Si no cierras el paladar, puedes atragantarte y perder una vida! .");
		}; break;
		case 3:{
			$(".instrucciones").html("Usa el botón de cerrar traquea para ordenar a la tráquea que se cierre, y así el alimento puede pasar sin llegar a los pulmones.");
		}; break;

		case 4:{
			$(".instrucciones").html("Con la tráquea cerrada y el paladar cerrado, puedes usar la lengua para empujar el bolo alimenticio al esófago.");
		}; break;
	}
}

function reduceSaliva()
{
	nivelSaliva = (nivelSaliva - reduccionSalivaPorAcion) >= 0 ? (nivelSaliva - reduccionSalivaPorAcion) : 0;
	$(".nivelSaliva .medidor").css("width", nivelSaliva + "%");
}

function agregarSaliva(valor)
{
	nivelSaliva = (nivelSaliva + valor) <= 100 ? (nivelSaliva + valor) : 100;
	$(".nivelSaliva .medidor").css("width", nivelSaliva + "%");
}

/* 0 = ingresa,  = masticar, 2 = cerrarPaladar, 3 = cerrarTraquea, 4 = usaLengua, 5 = traga*/
function ProcesaMasticar(ejecutor)
{
	switch(etapaActual)
	{
		case 0:{
			ingresaBoca();
			etapaActual++;
		}break;
		case 1:{
			if(ejecutor == "proceso" || ejecutor == "masticar" || ejecutor == "jugo")
			{
				masticar();
				if(masticadasActuales >= masticadasNecesarias)
				{
					etapaActual++;
					antesDePaladar();
				}
			}
			else
				atraganta();
		}break;
		case 2:{
			if(ejecutor == "proceso" || ejecutor == "paladar_btn")
			{
				antesDeTraquea();
				etapaActual++;
			}
			else
				atraganta();
		}; break;
		case 3:{
			if(ejecutor == "proceso" || ejecutor == "traquea_btn")
			{
				antesDeLengua();
				etapaActual++;
			}
			else
				atraganta();
		}; break;

		case 4:{
			if(ejecutor == "proceso" || ejecutor == "lengua_btn")
			{
				traga();
				etapaActual = 0;
			}
			else
				atraganta();
		}; break;
	}

	if(numeroNivel == 0)
		instrucciones();
	else
		$(".instrucciones").html("");
}

function ingresaBoca()
{
	$(".bolo").animate({ left: "205px" }, 500);
}

function antesDePaladar()
{
	$(".bolo").animate({ left: "175px" }, 500);
}

function antesDeTraquea()
{
	$(".bolo").animate({ left: "154px", top: "150px" }, 500);
}

function antesDeLengua()
{
	$(".bolo").animate({ left: "125px", top: "174px" }, 500);
}

function traga()
{
	$(".bolo").animate({ top: "220px" }, 500, function(){
		reiniciaComida(true);
	});
}

function masticar()
{
	if(nivelSaliva > 0)
	{
		$(".panelJuego .cabeza .mandibula").addClass("masticar");
		setTimeout(function () {
		    $(".panelJuego .cabeza .mandibula").removeClass('masticar');	    
		}, 250);
		reduceSaliva();
		cambiaColorBolo();
		masticadasActuales++;
	}
}

function consumeBolo()
{
	totalBolosConsumidos++;
	bolosConsumidos++;
	bolosRestantes--;

	$(".bolosRestantes .value").html(bolosRestantes);
	$(".bolosConsumidos .value").html(totalBolosConsumidos);

	if(bolosConsumidos < nivelActual.numeroBolos)
	{
		etapaActual = 0;
		ProcesaMasticar("proceso");
	}
	else
	{
		numeroNivel++;
		agregarSaliva(nivelActual.recargaSaliva);
		procesarNivel();
	}
}

function cambiaColorBolo()
{
	switch(masticadasActuales)
	{
		case 0: $(".bolo").css("background-color", "black"); break;
		case 1: $(".bolo").css("background-color", "black"); break;
		case 2: $(".bolo").css("background-color", "#001800"); break;
		case 3: $(".bolo").css("background-color", "#002500"); break;
		case 4: $(".bolo").css("background-color", "#002800"); break;
		case 5: $(".bolo").css("background-color", "#003100"); break;
		case 6: $(".bolo").css("background-color", "#004b00"); break;
		case 7: $(".bolo").css("background-color", "#006400"); break;
		case 8: $(".bolo").css("background-color", "#007e00"); break;
		case 9: $(".bolo").css("background-color", "#009700"); break;
		case 10: $(".bolo").css("background-color", "#00b100"); break;
	}
}

function consumeJugo()
{
	masticadasActuales = masticadasNecesarias;
	ProcesaMasticar("jugo");
	agregarSaliva(100);
}

function reiniciaComida(procesoCorrecto)
{
	if(procesoCorrecto)
	{
		$(".bolo").fadeOut(100, function(){
			$(".bolo").animate({ left: "270px", top: "165px" }, 500, function(){
				$(".bolo").fadeIn(100);
				consumeBolo();
			});
		});
	}

	masticadasActuales = 0;
	cambiaColorBolo();
	etapaActual = 0;
	ProcesaMasticar("proceso");
}

function atraganta()
{

	$(".instrucciones").html("Recuerda el proceso si no quieres atragantarte de nuevo.");
	quitaVida();
	seAtraganto = true;
	alert("atragantado");
	agregarSaliva(100);
	reiniciaComida(false);
}

function entregaPowerUps()
{
	if(!seAtraganto)
		agregarJugos(3);
}

function agregarJugos(cantidad)
{
	jugos += cantidad;
}

function agregaVida(vida)
{
	vidasDisponibles = (vidasDisponibles + vida) <= 100 ? (vidasDisponibles + vida) : 100;
	$(".vidasDisponibles .medidor").css("width", vidasDisponibles + "%");
}

function quitaVida()
{
	vidasDisponibles -= disminucionVidaPorAtragantamiento;
	if(vidasDisponibles > 0)
		$(".vidasDisponibles .medidor").css("width", vidasDisponibles + "%");
	else
		AvanzaMundo();
}

function AvanzaMundo()
{
	bolosTotalesConsumidos = totalBolosConsumidos;
	CambiarEscena("11_resultadosJuego.html");
}

</script>

<div class='contenidoCapitulo'>

	<h3 class="titulo">Juego de masticar</h3>
	<div class="panelJuego">

		<div class="seccion acciones">
			<div class="masticar_btn">Masticar</div>
			<div class="paladar_btn">Cierra el paladar</div>
			<div class="traquea_btn">Cierra la traquea</div>
			<div class="lengua_btn">Usa la lengua</div>
		</div>

		<div class="seccion bonos">
			<div class="jugo">Jugo (<span class='value'>0</span>)</div>
		</div>

		<div class="seccion indicadores">
			<div class="nivel">Nivel 0 - Tutorial</div>
			<div class="nivelSaliva">
				<span class='medidor'></span>
				<span class='texto'>Nivel de saliva</span>
			</div>
			<div class="vidasDisponibles">
				<span class='medidor'></span>
				<span class='texto'>Vida disponible</span>
			</div>
		</div>

		<div class="seccion marcadores">
			<div class="bolosConsumidos">
				Bolos consumidos
				<span class="value">0</span>
			</div>
			<div class="puntajeMasAlto">
				Puntaje
				<span class="value">0</span>
			</div>
			<div class="bolosRestantes">
				Bolos restantes
				<span class="value">0</span>
			</div>
		</div>

		<div class="seccion tiempo">
			<div>
				Tiempo
				<span class="value">0</span>
			</div>
		</div>

		<div class="seccion instrucciones">

		</div>

		<div class="cabeza">
			<div class="mandibula"></div>
			<div class="esofago"></div>
			<div class="traquea"></div>
			<div class="glandulas"></div>
			<div class="paladar"></div>
			<div class="bolo"></div>
		</div>

	</div>
	<div class='button'>Continuar</div>

</div>